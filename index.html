<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZaaShop Marketplace</title>
  <style>
    :root {
      --primary: #ff85a2; /* Soft pink */
      --primary-dark: #ff6b8b; /* Darker pink */
      --secondary: #fff0f5; /* Very light pink */
      --accent: #ffb6c1; /* Light pink */
      --dark: #5a3d4a; /* Dark purple-pink */
      --light: #fff9fb; /* Off-white with pink tint */
      --success: #a8e6cf; /* Mint green */
      --text: #5a3d4a; /* Dark text */
      --text-light: #8b6b7d; /* Lighter text */
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Comic Sans MS', 'Marker Felt', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--light);
      color: var(--text);
      line-height: 1.6;
    }
    
    /* Header */
    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 1rem;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(255, 133, 162, 0.3);
    }
    
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .logo {
      font-size: 1.8rem;
      font-weight: bold;
      color: white;
      text-decoration: none;
      text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .logo::before {
      content: "üõçÔ∏è";
    }
    
    .cart-btn {
      background: white;
      color: var(--primary);
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    
    .cart-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }
    
    .cart-count {
      background: var(--primary);
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
    }
    
    /* Main Content */
    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    
    h1 {
      text-align: center;
      margin-bottom: 2rem;
      color: var(--dark);
      font-size: 2.2rem;
      position: relative;
      display: inline-block;
      width: 100%;
    }
    
    h1::after {
      content: "‚ú®";
      position: absolute;
      right: 10%;
      top: -10px;
    }
    
    h1::before {
      content: "üíñ";
      position: absolute;
      left: 10%;
      top: -10px;
    }
    
    /* Product Grid */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 2rem;
    }
    
    .product-card {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(255, 133, 162, 0.1);
      transition: all 0.3s ease;
      border: 2px solid var(--accent);
      position: relative;
    }
    
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(255, 133, 162, 0.2);
    }
    
    .product-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, #ff85a2, #ffb6c1, #ffd3b6, #a8e6cf, #dcedc1, #ffaaa5, #ff85a2);
      background-size: 200% auto;
      animation: gradient 3s linear infinite;
    }
    
    .product-img-container {
      width: 100%;
      height: 200px;
      background: var(--secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      border-bottom: 2px dashed var(--accent);
    }
    
    .product-img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      padding: 1rem;
      transition: transform 0.3s ease;
    }
    
    .product-card:hover .product-img {
      transform: scale(1.05);
    }
    
    .product-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--primary);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .product-content {
      padding: 1.5rem;
    }
    
    .product-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--dark);
    }
    
    .product-category {
      display: inline-block;
      background: var(--accent);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 15px;
      font-size: 0.8rem;
      margin-bottom: 0.75rem;
      font-weight: bold;
    }
    
    .product-price {
      color: var(--primary-dark);
      font-weight: bold;
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
    }
    
    .product-stock {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    .product-stock::before {
      content: "üîπ";
    }
    
    .product-detail {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-bottom: 1.5rem;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .product-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .btn {
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-family: 'Comic Sans MS', cursive;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline:hover {
      background: var(--secondary);
      transform: translateY(-2px);
    }
    
    /* Cart Sidebar */
    .cart-overlay {
      position: fixed;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      display: none;
    }
    
    .cart-sidebar {
      position: fixed;
      top: 0;
      right: 0;
      width: 100%;
      max-width: 400px;
      height: 100%;
      background: white;
      box-shadow: -5px 0 15px rgba(255, 133, 162, 0.2);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      display: flex;
      flex-direction: column;
      z-index: 1001;
      border-left: 5px solid var(--primary);
    }
    
    .cart-sidebar.active {
      transform: translateX(0);
    }
    
    .cart-header {
      padding: 1.5rem;
      border-bottom: 2px dashed var(--accent);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--secondary);
    }
    
    .cart-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .cart-title::before {
      content: "üõí";
    }
    
    .close-cart {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--primary);
      transition: transform 0.3s;
    }
    
    .close-cart:hover {
      transform: rotate(90deg);
    }
    
    .cart-items {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      background: var(--light);
    }
    
    .cart-item {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      border-bottom: 2px dashed var(--accent);
      background: white;
      border-radius: 10px;
      margin-bottom: 0.5rem;
      box-shadow: 0 2px 5px rgba(255, 133, 162, 0.1);
    }
    
    .cart-item-img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      background: var(--secondary);
      border-radius: 10px;
      padding: 0.5rem;
      border: 2px solid var(--accent);
    }
    
    .cart-item-details {
      flex: 1;
    }
    
    .cart-item-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--dark);
    }
    
    .cart-item-price {
      color: var(--primary-dark);
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    
    .cart-item-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .quantity-control {
      display: flex;
      align-items: center;
      border: 2px solid var(--accent);
      border-radius: 15px;
      overflow: hidden;
    }
    
    .quantity-btn {
      background: var(--secondary);
      border: none;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      font-size: 1rem;
      color: var(--primary-dark);
    }
    
    .quantity-input {
      width: 40px;
      text-align: center;
      border: none;
      border-left: 2px solid var(--accent);
      border-right: 2px solid var(--accent);
      padding: 0.25rem;
      font-weight: bold;
      color: var(--dark);
    }
    
    .remove-item {
      background: none;
      border: none;
      color: #ff6b8b;
      cursor: pointer;
      margin-left: auto;
      font-size: 1.2rem;
      transition: transform 0.3s;
    }
    
    .remove-item:hover {
      transform: scale(1.2);
    }
    
    .cart-footer {
      padding: 1.5rem;
      border-top: 2px dashed var(--accent);
      background: var(--secondary);
    }
    
    .cart-total {
      display: flex;
      justify-content: space-between;
      font-size: 1.3rem;
      font-weight: bold;
      margin-bottom: 1.5rem;
      color: var(--dark);
    }
    
    .checkout-btn {
      width: 100%;
      padding: 1rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 15px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Comic Sans MS', cursive;
      box-shadow: 0 3px 8px rgba(255, 133, 162, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .checkout-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(255, 133, 162, 0.4);
    }
    
    /* Loading and Error States */
    .loading, .error-message {
      text-align: center;
      padding: 2rem;
      grid-column: 1/-1;
    }
    
    .loading {
      color: var(--text-light);
      font-size: 1.2rem;
    }
    
    .error-message {
      color: #ff6b8b;
      font-size: 1.2rem;
    }
    
    .retry-btn {
      margin-top: 1rem;
      padding: 0.6rem 1.2rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    
    .retry-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    /* Animations */
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }
    
    @keyframes slideIn {
      from { bottom: -50px; opacity: 0; }
      to { bottom: 20px; opacity: 1; }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    
    /* Kawaii Elements */
    .kawaii-element {
      position: fixed;
      z-index: -1;
      opacity: 0.2;
      animation: float 6s ease-in-out infinite;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .product-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      }
      
      .cart-sidebar {
        width: 90%;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      h1::after, h1::before {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Kawaii floating elements -->
  <div class="kawaii-element" style="top: 10%; left: 5%; font-size: 3rem;">üå∏</div>
  <div class="kawaii-element" style="top: 30%; right: 8%; font-size: 2rem;">üçì</div>
  <div class="kawaii-element" style="bottom: 20%; left: 7%; font-size: 4rem;">üíñ</div>
  <div class="kawaii-element" style="bottom: 40%; right: 5%; font-size: 3rem;">‚ú®</div>
  
  <!-- Header -->
  <header>
    <div class="navbar">
      <a href="#" class="logo">ZaaShop</a>
      <button class="cart-btn" id="cartBtn">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="cartCount">0</span>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container">
    <h1>Produk ZaaShop</h1>
    <div class="product-grid" id="productList">
      <div class="loading">Memuat produk... <span style="display: inline-block; animation: float 2s ease-in-out infinite;">üå∏</span></div>
    </div>
  </div>

  <!-- Cart Sidebar -->
  <div class="cart-overlay" id="cartOverlay"></div>
  <div class="cart-sidebar" id="cartSidebar">
    <div class="cart-header">
      <h2 class="cart-title">Keranjang Belanja</h2>
      <button class="close-cart" id="closeCart">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="cart-items" id="cartItems">
      <!-- Cart items will be added here -->
    </div>
    <div class="cart-footer">
      <div class="cart-total">
        <span>Total:</span>
        <span id="cartTotal">Rp 0</span>
      </div>
      <button class="checkout-btn" id="checkoutBtn">
        <i class="fab fa-whatsapp"></i> Pesan via WhatsApp
      </button>
    </div>
  </div>

  <script>
    // DOM Elements
    const productList = document.getElementById("productList");
    const cartBtn = document.getElementById("cartBtn");
    const cartCount = document.getElementById("cartCount");
    const cartOverlay = document.getElementById("cartOverlay");
    const cartSidebar = document.getElementById("cartSidebar");
    const closeCart = document.getElementById("closeCart");
    const cartItems = document.getElementById("cartItems");
    const cartTotal = document.getElementById("cartTotal");
    const checkoutBtn = document.getElementById("checkoutBtn");

    // State
    let products = [];
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    // WhatsApp Configuration
    const WHATSAPP_NUMBER = "6281234567890"; // Ganti dengan nomor WhatsApp Anda
    const COMPANY_NAME = "ZaaShop";

    // API Configuration
    const API_ENDPOINT = "https://crud-api-production-1baf.up.railway.app/api/products";

    // Dummy Data with kawaii products
    const dummyData = [
      {
        id: 1,
        nama_produk: "Bando Hello Kitty",
        kategori: "Aksesoris",
        harga: 45000,
        gambar: "https://via.placeholder.com/300x200.png/ff85a2/ffffff?text=Hello+Kitty",
        detail: "Bando lucu dengan hiasan Hello Kitty, cocok untuk sehari-hari",
        stok: 8
      },
      {
        id: 2,
        nama_produk: "Tas Ransel Strawberry",
        kategori: "Tas",
        harga: 120000,
        gambar: "https://via.placeholder.com/300x200.png/ffb6c1/ffffff?text=Tas+Strawberry",
        detail: "Tas ransel motif strawberry dengan hiasan pom-pom",
        stok: 5
      },
      {
        id: 3,
        nama_produk: "Notebook Sanrio",
        kategori: "Alat Tulis",
        harga: 35000,
        gambar: "https://via.placeholder.com/300x200.png/a8e6cf/ffffff?text=Notebook+Sanrio",
        detail: "Notebook bergambar karakter Sanrio dengan 100 halaman",
        stok: 12
      },
      {
        id: 4,
        nama_produk: "Gelang Pearl",
        kategori: "Aksesoris",
        harga: 25000,
        gambar: "https://via.placeholder.com/300x200.png/ffd3b6/ffffff?text=Gelang+Pearl",
        detail: "Gelang mutiara dengan charm berbentuk hati",
        stok: 3
      },
      {
        id: 5,
        nama_produk: "Sarung HP Pompompurin",
        kategori: "Aksesoris",
        harga: 55000,
        gambar: "https://via.placeholder.com/300x200.png/dcedc1/ffffff?text=Pompompurin",
        detail: "Case HP karakter Pompompurin dengan bahan silicone",
        stok: 7
      },
      {
        id: 6,
        nama_produk: "Stiker Decora",
        kategori: "Stiker",
        harga: 15000,
        gambar: "https://via.placeholder.com/300x200.png/ffaaa5/ffffff?text=Stiker+Decora",
        detail: "Paket stiker decora berbagai motif dan ukuran",
        stok: 20
      }
    ];

    // Format Rupiah
    function formatRupiah(angka) {
      return new Intl.NumberFormat('id-ID', {
        style: 'currency',
        currency: 'IDR',
        minimumFractionDigits: 0
      }).format(angka);
    }

    // Generate WhatsApp message
    function generateWhatsAppMessage() {
      let message = `Halo ${COMPANY_NAME}, saya ingin memesan:\n\n`;
      
      cart.forEach(item => {
        message += `‚û° ${item.nama_produk}\n`;
        message += `   Jumlah: ${item.quantity}\n`;
        message += `   Harga: ${formatRupiah(item.harga)}\n`;
        message += `   Subtotal: ${formatRupiah(item.harga * item.quantity)}\n\n`;
      });
      
      message += `Total Pesanan: ${cartTotal.textContent}\n\n`;
      message += `Apakah produk masih tersedia?`;
      
      return encodeURIComponent(message);
    }

    // Open WhatsApp
    function openWhatsApp() {
      if (cart.length === 0) {
        showErrorNotification('Keranjang belanja kosong!');
        return;
      }
      
      const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${generateWhatsAppMessage()}`;
      window.open(whatsappUrl, '_blank');
      
      // Kosongkan keranjang setelah pesan dikirim
      cart = [];
      saveCart();
      closeCartSidebar();
    }

    // Buy Now function (direct to WhatsApp for single product)
    function buyNow(e) {
      const productCard = e.target.closest('.product-card');
      const productId = parseInt(productCard.dataset.id);
      const product = products.find(p => p.id === productId);
      
      if (!product) return;
      
      const message = `Halo ${COMPANY_NAME}, saya ingin membeli:\n\n` +
                     `‚û° ${product.nama_produk}\n` +
                     `   Harga: ${formatRupiah(product.harga)}\n\n` +
                     `Apakah produk masih tersedia?`;
      
      const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    }

    // Fetch Products
    async function loadProducts() {
      try {
        productList.innerHTML = '<div class="loading">Memuat produk... <span style="display: inline-block; animation: float 2s ease-in-out infinite;">üå∏</span></div>';
        
        // Try to fetch from API first
        let data;
        try {
          const response = await fetch(API_ENDPOINT);
          if (response.ok) {
            data = await response.json();
          } else {
            throw new Error("API response not OK");
          }
        } catch (error) {
          console.log("Gagal mengambil data dari API, menggunakan data dummy");
          data = dummyData;
        }
        
        console.log('Data produk:', data);
        
        if (!data || data.length === 0) {
          throw new Error("Tidak ada produk tersedia");
        }

        products = data;
        renderProducts();
        updateCartCount();
        
      } catch (error) {
        console.error("Error:", error);
        showError(`Gagal memuat produk. ${error.message}`);
      }
    }

    // Render Products
    function renderProducts() {
      if (products.length === 0) {
        productList.innerHTML = '<div class="loading">Tidak ada produk tersedia <span style="display: inline-block; animation: float 2s ease-in-out infinite;">üò¢</span></div>';
        return;
      }

      productList.innerHTML = products.map(product => `
        <div class="product-card" data-id="${product.id}">
          <div class="product-img-container">
            <img src="${product.gambar || 'https://via.placeholder.com/300x200.png/ff85a2/ffffff?text=Produk+ZaaShop'}" 
                 alt="${product.nama_produk}"
                 class="product-img"
                 onerror="this.src='https://via.placeholder.com/300x200.png/ff85a2/ffffff?text=Gambar+Error'">
            ${product.stok <= 3 ? '<span class="product-badge">Hampir Habis!</span>' : ''}
          </div>
          <div class="product-content">
            <h3 class="product-title">${product.nama_produk || 'Produk ZaaShop'}</h3>
            <span class="product-category">${product.kategori || 'Umum'}</span>
            <div class="product-price">${formatRupiah(product.harga || 0)}</div>
            <div class="product-stock">Stok: ${product.stok || 0}</div>
            <p class="product-detail">${product.detail || 'Produk eksklusif dari ZaaShop!'}</p>
            <div class="product-actions">
              <button class="btn btn-outline add-to-cart">
                <i class="fas fa-cart-plus"></i> Keranjang
              </button>
              <button class="btn btn-primary buy-now">
                <i class="fab fa-whatsapp"></i> Beli Sekarang
              </button>
            </div>
          </div>
        </div>
      `).join('');

      // Add event listeners to buttons
      document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', addToCart);
      });

      document.querySelectorAll('.buy-now').forEach(button => {
        button.addEventListener('click', buyNow);
      });
    }

    // Cart Functions
    function addToCart(e) {
      const productCard = e.target.closest('.product-card');
      const productId = parseInt(productCard.dataset.id);
      const product = products.find(p => p.id === productId);
      
      if (!product) return;
      
      // Check if product already in cart
      const existingItem = cart.find(item => item.id === productId);
      
      if (existingItem) {
        // Check stock
        if (existingItem.quantity >= product.stok) {
          showErrorNotification('Stok tidak mencukupi! üò¢');
          return;
        }
        existingItem.quantity += 1;
      } else {
        cart.push({
          ...product,
          quantity: 1
        });
      }
      
      saveCart();
      updateCartCount();
      showSuccessNotification(`${product.nama_produk} ditambahkan ke keranjang! üíñ`);
    }

    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
      renderCartItems();
    }

    function updateCartCount() {
      const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
      cartCount.textContent = totalItems;
      
      // Add animation when cart updates
      if (totalItems > 0) {
        cartCount.style.transform = 'scale(1.3)';
        setTimeout(() => {
          cartCount.style.transform = 'scale(1)';
        }, 300);
      }
    }

    function renderCartItems() {
      if (cart.length === 0) {
        cartItems.innerHTML = `
          <div style="text-align: center; padding: 2rem;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üõí</div>
            <p>Keranjang belanja kosong</p>
            <p style="color: var(--text-light); margin-top: 0.5rem;">Ayo belanja produk ZaaShop!</p>
          </div>
        `;
        cartTotal.textContent = formatRupiah(0);
        return;
      }

      cartItems.innerHTML = cart.map(item => `
        <div class="cart-item" data-id="${item.id}">
          <img src="${item.gambar || 'https://via.placeholder.com/100x100.png/ff85a2/ffffff?text=Produk'}" 
               alt="${item.nama_produk}"
               class="cart-item-img"
               onerror="this.src='https://via.placeholder.com/100x100.png/ff85a2/ffffff?text=Gambar+Error'">
          <div class="cart-item-details">
            <h4 class="cart-item-title">${item.nama_produk}</h4>
            <div class="cart-item-price">${formatRupiah(item.harga)}</div>
            <div class="cart-item-actions">
              <div class="quantity-control">
                <button class="quantity-btn decrease">-</button>
                <input type="number" class="quantity-input" value="${item.quantity}" min="1" max="${item.stok}">
                <button class="quantity-btn increase">+</button>
              </div>
              <button class="remove-item">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      `).join('');

      // Calculate total
      const total = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
      cartTotal.textContent = formatRupiah(total);

      // Add event listeners
      document.querySelectorAll('.decrease').forEach(btn => {
        btn.addEventListener('click', decreaseQuantity);
      });

      document.querySelectorAll('.increase').forEach(btn => {
        btn.addEventListener('click', increaseQuantity);
      });

      document.querySelectorAll('.quantity-input').forEach(input => {
        input.addEventListener('change', updateQuantity);
      });

      document.querySelectorAll('.remove-item').forEach(btn => {
        btn.addEventListener('click', removeItem);
      });
    }

    function decreaseQuantity(e) {
      const cartItem = e.target.closest('.cart-item');
      const productId = parseInt(cartItem.dataset.id);
      const item = cart.find(item => item.id === productId);
      
      if (item.quantity > 1) {
        item.quantity -= 1;
        saveCart();
        showInfoNotification(`Jumlah ${item.nama_produk} dikurangi`);
      }
    }

    function increaseQuantity(e) {
      const cartItem = e.target.closest('.cart-item');
      const productId = parseInt(cartItem.dataset.id);
      const item = cart.find(item => item.id === productId);
      const product = products.find(p => p.id === productId);
      
      if (item.quantity < product.stok) {
        item.quantity += 1;
        saveCart();
        showInfoNotification(`Jumlah ${item.nama_produk} ditambah`);
      } else {
        showErrorNotification('Stok tidak mencukupi! üò¢');
      }
    }

    function updateQuantity(e) {
      const cartItem = e.target.closest('.cart-item');
      const productId = parseInt(cartItem.dataset.id);
      const item = cart.find(item => item.id === productId);
      const product = products.find(p => p.id === productId);
      const newQuantity = parseInt(e.target.value);
      
      if (newQuantity >= 1 && newQuantity <= product.stok) {
        item.quantity = newQuantity;
        saveCart();
      } else {
        e.target.value = item.quantity;
        showErrorNotification('Stok tidak mencukupi! üò¢');
      }
    }

    function removeItem(e) {
      const cartItem = e.target.closest('.cart-item');
      const productId = parseInt(cartItem.dataset.id);
      const item = cart.find(item => item.id === productId);
      
      cart = cart.filter(item => item.id !== productId);
      saveCart();
      showInfoNotification(`${item.nama_produk} dihapus dari keranjang`);
    }

    // Cart UI
    function openCart() {
      cartOverlay.style.display = 'block';
      cartSidebar.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeCartSidebar() {
      cartOverlay.style.display = 'none';
      cartSidebar.classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    // Notification functions
    function showSuccessNotification(message) {
      showNotification(message, '#a8e6cf', '‚úÖ');
    }
    
    function showErrorNotification(message) {
      showNotification(message, '#ffaaa5', '‚ùå');
    }
    
    function showInfoNotification(message) {
      showNotification(message, '#dcedc1', '‚ÑπÔ∏è');
    }
    
    function showNotification(message, bgColor, icon) {
      const notification = document.createElement('div');
      notification.style.position = 'fixed';
      notification.style.bottom = '20px';
      notification.style.left = '50%';
      notification.style.transform = 'translateX(-50%)';
      notification.style.backgroundColor = bgColor;
      notification.style.color = '#5a3d4a';
      notification.style.padding = '12px 24px';
      notification.style.borderRadius = '15px';
      notification.style.boxShadow = '0 5px 15px rgba(0,0,0,0.1)';
      notification.style.zIndex = '1000';
      notification.style.animation = 'slideIn 0.3s, fadeOut 0.5s 2.5s forwards';
      notification.style.display = 'flex';
      notification.style.alignItems = 'center';
      notification.style.gap = '0.5rem';
      notification.style.fontWeight = 'bold';
      notification.innerHTML = `${icon} ${message}`;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // Error Handling
    function showError(message) {
      productList.innerHTML = `
        <div class="error-message">
          <i class="fas fa-exclamation-triangle"></i>
          <p>${message}</p>
          <button class="retry-btn" onclick="loadProducts()">
            <i class="fas fa-sync-alt"></i> Coba Lagi
          </button>
        </div>
      `;
    }

    // Event Listeners
    cartBtn.addEventListener('click', openCart);
    cartOverlay.addEventListener('click', closeCartSidebar);
    closeCart.addEventListener('click', closeCartSidebar);
    checkoutBtn.addEventListener('click', openWhatsApp);

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadProducts();
      renderCartItems();
    });
  </script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</body>
</html>